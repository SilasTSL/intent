<% layout('layouts/boilerplate') %>
<div class="rows">
    <h1 class="text-center mt-5">Edit Weekly Task</h1>
    <div class="col-6 offset-3">
        <form id="editWeeklyTaskForm" method="POST" action="/weekly-tasks/<%= weeklyTask._id %>?_method=PUT">
            <div class="mb-3">
                <label class="form-label" for="title">Title</label>
                <input class="form-control" type="text" id="title" name="weeklyTask[title]" value="<%= weeklyTask.title %>" required>
                <div class="valid-feedback">Looks good!</div>
            </div>
            <div class="mb-3">
                <label class="form-label" for="releasedOn">Released On</label>
                <select class="form-select" id="releasedOn" name="weeklyTask[releasedOn]" required>
                    <option value="" selected disabled>Select a day</option>
                    <% const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']; %>
                    <% for (let i = 0; i < days.length; i++) { %>
                        <option value="<%= days[i] %>" <% if (weeklyTask.releasedOn === days[i]) { %> selected <% } %>><%= days[i] %></option>
                    <% } %>
                </select>
                <div class="valid-feedback">Looks good!</div>
            </div>
            <div class="mb-3">
                <label class="form-label" for="deadline">Deadline</label>
                <select class="form-select" id="deadline" name="weeklyTask[deadline]" required>
                    <option value="" selected disabled>Select a day</option>
                    <% for (let i = 0; i < days.length; i++) { %>
                        <option value="<%= days[i] %>" <% if (weeklyTask.deadline === days[i]) { %> selected <% } %>><%= days[i] %></option>
                    <% } %>
                </select>
                <div class="valid-feedback">Looks good!</div>
            </div>
            <div class="mb-3">
                <label class="form-label" for="duration">Duration</label>
                <input class="form-control" type="number" id="duration" name="weeklyTask[duration]" value="<%= weeklyTask.duration %>" required>
                <div class="valid-feedback">Looks good!</div>
            </div>
            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <button type="button" class="btn btn-danger" id="deleteButton">Delete</button>
                <a href="/weekly-tasks" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
    const deleteButton = document.getElementById('deleteButton');
    deleteButton.addEventListener('click', () => {
        if (confirm("Are you sure you want to delete this weekly task?")) {
            document.getElementById('editWeeklyTaskForm').action = "/timetable/<%= weeklyTask._id %>?_method=DELETE";
            document.getElementById('editWeeklyTaskForm').submit();
        }
    });
</script>